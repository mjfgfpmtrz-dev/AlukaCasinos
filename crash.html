<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crash</title>
<style>
html,body{margin:0;background:#0b0f1a;color:#fff;font-family:Inter,Arial}
#app{position:relative;width:100vw;height:100vh}
canvas{position:absolute;inset:0}
#mult{position:absolute;top:90px;width:100%;text-align:center;font-size:48px;font-weight:700}
#btn{position:absolute;bottom:80px;left:50%;transform:translateX(-50%);
width:88%;height:56px;border:none;border-radius:14px;background:#2b7cff;
color:#fff;font-size:18px;font-weight:600}
#balance{position:absolute;top:20px;left:20px;font-size:14px;opacity:.8}
#history{position:absolute;bottom:0;width:100%;background:#0f1424;padding:10px}
.hist{font-size:13px;opacity:.8}
</style>
</head>
<body>

<div id="app">
<canvas id="cv"></canvas>
<div id="balance">Баланс: <span id="bal">10.00</span> TON</div>
<div id="mult">x1.00</div>
<button id="btn">Сделать ставку</button>
<div id="history"></div>
</div>

<script>
/* ===== CANVAS ===== */
const cv = document.getElementById('cv');
const ctx = cv.getContext('2d');
cv.width = innerWidth;
cv.height = innerHeight;

/* ===== STATE ===== */
let state = 'WAIT';
let startTime = 0;
let elapsed = 0;
let mult = 1;
let crashX = 1;
let balance = 10;
let bet = null;
let history = [];

/* ===== LOGIC ===== */
function genCrash(){
  const r=Math.random();
  if(r<0.4) return 1+Math.random()*0.2;
  if(r<0.8) return 1.3+Math.random()*2;
  return 3+Math.random()*6;
}

function startRound(){
  crashX = genCrash();
  startTime = performance.now();
  state='FLY';
  bet=null;
}

function endRound(){
  history.unshift(crashX.toFixed(2));
  history = history.slice(0,6);
  setTimeout(startRound,2000);
}

function update(){
  if(state!=='FLY') return;

  elapsed = (performance.now()-startTime)/1000;
  mult = Math.exp(elapsed*0.6);

  if(mult>=crashX){
    state='CRASH';
    mult=crashX;
    if(bet) bet=null;
    endRound();
  }
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);

  // GRID
  ctx.strokeStyle='#1e2533';
  for(let x=0;x<cv.width;x+=60){
    ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,cv.height);ctx.stroke();
  }
  for(let y=0;y<cv.height;y+=60){
    ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(cv.width,y);ctx.stroke();
  }

  // CURVE
  ctx.beginPath();
  for(let t=0;t<elapsed;t+=0.02){
    const x=100+t*120;
    const y=cv.height-100-Math.exp(t*0.6)*60;
    t===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  }

  ctx.strokeStyle=state==='CRASH'?'#ff5252':'#4caf50';
  ctx.lineWidth=4;
  ctx.stroke();

  document.getElementById('mult').innerText=`x${mult.toFixed(2)}`;
  document.getElementById('bal').innerText=balance.toFixed(2);

  document.getElementById('history').innerHTML=
    history.map(x=>`<div class="hist">x${x}</div>`).join('');

  requestAnimationFrame(draw);
}

/* ===== BET ===== */
document.getElementById('btn').onclick=()=>{
  if(state==='WAIT'||state==='CRASH') return;
  if(!bet){
    bet={amount:1};
    balance-=1;
  }else{
    balance+=bet.amount*mult;
    bet=null;
  }
};

startRound();
setInterval(update,16);
draw();
</script>
</body>
</html>