<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
body{
  background:#05070f;
  color:#fff;
  overflow:hidden;
}

#app{width:100vw;height:100vh;position:relative}

/* TOP */
#top{
  position:absolute;
  top:10px;
  right:12px;
  background:#0f1b33;
  padding:8px 12px;
  border-radius:14px;
  font-weight:600;
  z-index:5;
}

/* MULT / TIMER */
#mult{
  position:absolute;
  top:80px;
  width:100%;
  text-align:center;
  font-size:38px;
  font-weight:700;
  text-shadow:0 0 15px #4fc3ff;
  z-index:4;
}
#timer{
  position:absolute;
  top:45%;
  width:100%;
  text-align:center;
  font-size:64px;
  opacity:.8;
  z-index:3;
}

/* CANVAS */
canvas{
  position:absolute;
  inset:0;
}

/* ROCKET */
#rocket{
  position:absolute;
  width:64px;
  height:64px;
  z-index:3;
}
#rocket svg{width:100%;height:100%}

/* CONTROLS */
#controls{
  position:absolute;
  bottom:90px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:10px;
  z-index:5;
}
#controls button{
  border:none;
  border-radius:14px;
  padding:14px 18px;
  font-size:16px;
  color:#fff;
}
.blue{background:#1e90ff}
.gray{background:#2a2f45}

/* INPUTS */
#inputs{
  position:absolute;
  bottom:150px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:10px;
}
#inputs input{
  width:110px;
  padding:10px;
  border-radius:12px;
  border:none;
  text-align:center;
}

/* BET LIST */
#bets{
  position:absolute;
  bottom:0;
  width:100%;
  max-height:160px;
  background:#0b1528;
  overflow:auto;
  padding:10px;
}
.bet{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid #162347;
  opacity:.9;
}
</style>
</head>

<body>
<div id="app">

<div id="top">TON <span id="balance">100.00</span></div>
<div id="mult">x1.00</div>
<div id="timer"></div>

<canvas id="cv"></canvas>

<div id="rocket">
<svg viewBox="0 0 24 24">
<path d="M12 2C9 6 9 14 12 22C15 14 15 6 12 2Z" fill="url(#g)"/>
<defs>
<linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
<stop offset="0%" stop-color="#6fd3ff"/>
<stop offset="100%" stop-color="#4f5dff"/>
</linearGradient>
</defs>
</svg>
</div>

<div id="inputs">
<input id="betAmount" type="number" step="0.1" min="0.1" placeholder="Ставка">
<input id="autoOut" type="number" step="0.01" placeholder="Авто x">
</div>

<div id="controls">
<button class="blue" id="betBtn">Сделать ставку</button>
<button class="gray" id="cancelBtn">Отмена</button>
<button class="gray" id="cashoutBtn">Забрать</button>
</div>

<div id="bets"></div>

</div>

<script>
const canvas = document.getElementById('cv');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

let balance = 100;
let bet = null;
let autoOut = null;
let flying = false;
let mult = 1;
let crashPoint = 0;
let t = 5;
let path = [];

const balEl = document.getElementById('balance');
const multEl = document.getElementById('mult');
const timerEl = document.getElementById('timer');
const rocket = document.getElementById('rocket');
const betsEl = document.getElementById('bets');

function weightedCrash(){
  const r=Math.random();
  if(r<0.6) return 1.3+Math.random()*1;
  if(r<0.85) return 2.4+Math.random()*1.2;
  if(r<0.95) return 4+Math.random()*2;
  return 6+Math.random()*4;
}

function countdown(){
  timerEl.innerText=t;
  if(t--<=0){timerEl.innerText='';start()}
  else setTimeout(countdown,1000);
}

function start(){
  flying=true;
  mult=1;
  crashPoint=weightedCrash();
  path=[];
  loop();
}

function loop(){
  if(!flying) return;

  mult += mult<1.3 ? 0.002 : 0.01 + mult*0.002;
  multEl.innerText='x'+mult.toFixed(2);

  if(bet && autoOut && mult>=autoOut) cashout();

  const x=path.length*6;
  const y=canvas.height-(mult*120);
  path.push({x,y});

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.beginPath();
  ctx.strokeStyle='#1e90ff';
  ctx.lineWidth=3;
  path.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
  ctx.stroke();

  rocket.style.left=x+'px';
  rocket.style.top=y-30+'px';

  if(mult>=crashPoint){flying=false;setTimeout(()=>{t=5;countdown()},1500);return;}
  requestAnimationFrame(loop);
}

function cashout(){
  if(!bet) return;
  balance+=bet*mult;
  bet=null;
  balEl.innerText=balance.toFixed(2);
}

document.getElementById('betBtn').onclick=()=>{
  if(flying||bet) return;
  const amt=parseFloat(betAmount.value);
  if(!amt||amt<0.1||amt>balance) return;
  bet=amt;
  autoOut=parseFloat(autoOut.value)||null;
  balance-=amt;
  balEl.innerText=balance.toFixed(2);
  betsEl.innerHTML+=`<div class="bet"><span>Игрок</span><span>${amt.toFixed(2)} TON</span></div>`;
};
document.getElementById('cancelBtn').onclick=()=>{
  if(flying||!bet) return;
  balance+=bet;bet=null;
  balEl.innerText=balance.toFixed(2);
};
document.getElementById('cashoutBtn').onclick=cashout;

countdown();
</script>
</body>
</html>