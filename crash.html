<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crash — Step 2</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI}
body{
  background:#0b1020;
  color:white;
  height:100vh;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

/* MULT */
.mult{
  position:absolute;
  top:80px;
  font-size:48px;
  font-weight:700;
  text-shadow:0 0 15px #4fc3ff;
}
.mult.crash{
  color:#ff4444;
  text-shadow:0 0 20px red;
}

/* TIMER */
.timer{
  position:absolute;
  top:140px;
  opacity:.6;
}

/* GRAPH */
canvas{
  position:absolute;
  bottom:140px;
  left:0;
  width:100%;
  height:60%;
}

/* BUTTON */
button{
  position:absolute;
  bottom:60px;
  padding:14px 26px;
  font-size:16px;
  border:none;
  border-radius:14px;
  background:#1e90ff;
  color:white;
}
button.gray{background:#2a2f45}
</style>
</head>

<body>

<div class="mult" id="mult">x1.00</div>
<div class="timer" id="timer">Ожидание: 5</div>
<canvas id="graph"></canvas>
<button id="mainBtn">СДЕЛАТЬ СТАВКУ</button>

<script>
/* ---------- CORE ---------- */
let state='WAITING';
let bet=false;
let timer=5;
let mult=1;
let crashPoint=0;
let interval;

/* ---------- UI ---------- */
const multEl=document.getElementById('mult');
const timerEl=document.getElementById('timer');
const btn=document.getElementById('mainBtn');

/* ---------- GRAPH ---------- */
const canvas=document.getElementById('graph');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;
canvas.height=window.innerHeight*0.6;
let path=[];

/* ---------- CRASH POINT ---------- */
function getCrashPoint(){
  const r=Math.random();
  if(r<0.65) return 1.3+Math.random()*1.2;
  if(r<0.85) return 2.5+Math.random()*1.5;
  if(r<0.95) return 4+Math.random()*2;
  return 6+Math.random()*4;
}

/* ---------- WAITING ---------- */
function startWaiting(){
  state='WAITING';
  bet=false;
  timer=5;
  mult=1;
  path=[];
  multEl.textContent='x1.00';
  multEl.classList.remove('crash');
  btn.textContent='СДЕЛАТЬ СТАВКУ';
  btn.className='';
  timerEl.textContent='Ожидание: '+timer;

  interval=setInterval(()=>{
    timer--;
    timerEl.textContent='Ожидание: '+timer;
    if(timer<=0){
      clearInterval(interval);
      startRound();
    }
  },1000);
}

/* ---------- ROUND ---------- */
function startRound(){
  state='FLYING';
  crashPoint=getCrashPoint();
  timerEl.textContent='Раунд идёт';
  btn.textContent=bet?'ЗАБРАТЬ':'—';
  btn.className=bet?'':'gray';
  fly();
}

/* ---------- MULT GROWTH ---------- */
function growMultiplier(){
  if(mult < 1.4) return 0.0025;        // очень медленно
  if(mult < 2)   return 0.005 + mult*0.001;
  return 0.01 + mult*0.002;            // ускорение
}

/* ---------- FLY ---------- */
function fly(){
  if(state!=='FLYING') return;

  mult += growMultiplier();
  multEl.textContent='x'+mult.toFixed(2);

  path.push({x:path.length,y:mult});
  drawGraph();

  if(mult>=crashPoint){
    crash();
    return;
  }
  requestAnimationFrame(fly);
}

/* ---------- GRAPH DRAW ---------- */
function drawGraph(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // grid
  ctx.strokeStyle='rgba(255,255,255,0.05)';
  for(let i=0;i<10;i++){
    ctx.beginPath();
    ctx.moveTo(0,i*canvas.height/10);
    ctx.lineTo(canvas.width,i*canvas.height/10);
    ctx.stroke();
  }

  // line
  ctx.beginPath();
  ctx.strokeStyle='#4fc3ff';
  ctx.lineWidth=2;
  ctx.shadowColor='#4fc3ff';
  ctx.shadowBlur=10;

  path.forEach((p,i)=>{
    const x=i*3;
    const y=canvas.height-(p.y*60);
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  });
  ctx.stroke();
}

/* ---------- CRASH ---------- */
function crash(){
  state='CRASH';
  multEl.classList.add('crash');
  timerEl.textContent='CRASH на x'+mult.toFixed(2);
  btn.textContent='—';
  btn.className='gray';
  setTimeout(startWaiting,2000);
}

/* ---------- BUTTON ---------- */
btn.onclick=()=>{
  if(state==='WAITING'){
    if(!bet){
      bet=true;
      btn.textContent='ОТМЕНИТЬ';
      btn.className='gray';
    }else{
      bet=false;
      btn.textContent='СДЕЛАТЬ СТАВКУ';
      btn.className='';
    }
  }
  else if(state==='FLYING' && bet){
    bet=false;
    btn.textContent='—';
    btn.className='gray';
    timerEl.textContent='Забрал на x'+mult.toFixed(2);
  }
};

startWaiting();
</script>

</body>
</html>